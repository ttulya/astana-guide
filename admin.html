<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Админ-панель — Бронирования</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Montserrat',sans-serif;
  background:#f0f4f8;
  padding:20px;
}

h1{
  color:#0072ff;
  margin-bottom:10px;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:20px;
  background:white;
  border-radius:10px;
  overflow:hidden;
  box-shadow:0 4px 10px rgba(0,0,0,0.1);
}

th,td{
  padding:10px 8px;
  border-bottom:1px solid #eee;
  text-align:left;
  font-size:14px;
}

th{
  background:#eaf2ff;
  font-weight:600;
}

tr:nth-child(even){
  background:#fafafa;
}

.btn{
  display:inline-block;
  background:#0072ff;
  color:white;
  padding:10px 16px;
  border-radius:6px;
  cursor:pointer;
  border:none;
  margin-top:10px;
  font-size:14px;
}

.btn:hover{
  background:#005ec4;
}

.info{
  font-size:14px;
  color:#444;
  margin:5px 0 15px 0;
}

#noData{
  margin-top:20px;
  color:#777;
  font-style:italic;
}

/* Статусы */
.status-badge{
  display:inline-block;
  padding:3px 9px;
  border-radius:999px;
  font-size:12px;
  color:#fff;
}
.status-new{
  background:#607d8b;      /* Новая — серая */
}
.status-processed{
  background:#ff9800;      /* Обработана — оранжевая */
}
.status-done{
  background:#4caf50;      /* Завершён — зелёная */
}
.status-cancelled{
  background:#f44336;      /* Отменена — красная */
}

.status-select{
  font-size:12px;
  padding:4px 6px;
  border-radius:6px;
  border:1px solid #ccc;
}
</style>
</head>

<body>

<h1>Админ-панель бронирований</h1>
<p class="info">Эта страница доступна только сотрудникам по прямой ссылке.</p>
<p class="info">Всего бронирований: <b id="count">0</b></p>

<button class="btn" onclick="clearBookings()">Очистить все бронирования</button>

<div id="noData" style="display:none;">Нет ни одной брони.</div>

<table id="table" style="display:none;">
  <thead>
    <tr>
      <th>ID</th>
      <th>Имя</th>
      <th>Телефон</th>
      <th>Дата</th>
      <th>Время</th>
      <th>Часы</th>
      <th>Статус</th>
      <th>Изменить</th>
    </tr>
  </thead>
  <tbody id="tbody"></tbody>
</table>

<script>
const STATUS_LABELS = {
  new: "Новая",
  processed: "Обработана",
  done: "Сеанс завершён",
  cancelled: "Отменена"
};

function getStatusLabel(value){
  return STATUS_LABELS[value] || "Новая";
}

function load(){
  const bookings = JSON.parse(localStorage.getItem("bookings") || "[]");
  const countEl  = document.getElementById("count");
  const noData   = document.getElementById("noData");
  const table    = document.getElementById("table");
  const tbody    = document.getElementById("tbody");

  countEl.textContent = bookings.length;

  if(bookings.length === 0){
    noData.style.display = "block";
    table.style.display = "none";
    tbody.innerHTML = "";
    return;
  }

  noData.style.display = "none";
  table.style.display = "table";

  tbody.innerHTML = bookings
    .map((b, index) => {
      const statusValue = b.status || "new";
      const label = getStatusLabel(statusValue);
      return `
      <tr>
        <td>${b.id || "-"}</td>
        <td>${b.name || "-"}</td>
        <td>${b.phone || "-"}</td>
        <td>${b.date || "-"}</td>
        <td>${b.time || "-"}</td>
        <td>${b.duration || "-"}</td>
        <td>
          <span class="status-badge status-${statusValue}">${label}</span>
        </td>
        <td>
          <select class="status-select" onchange="changeStatus(${index}, this.value)">
            <option value="new" ${statusValue==="new"?"selected":""}>Новая</option>
            <option value="processed" ${statusValue==="processed"?"selected":""}>Обработана</option>
            <option value="done" ${statusValue==="done"?"selected":""}>Сеанс завершён</option>
            <option value="cancelled" ${statusValue==="cancelled"?"selected":""}>Отменена</option>
          </select>
        </td>
      </tr>
      `;
    })
    .join("");
}

function changeStatus(index, newStatus){
  let bookings = JSON.parse(localStorage.getItem("bookings") || "[]");
  if(!bookings[index]) return;
  bookings[index].status = newStatus;
  localStorage.setItem("bookings", JSON.stringify(bookings));
  load(); // перерисовать с обновлённым статусом
}

function clearBookings(){
  if(!confirm("Удалить все бронирования? Это действие нельзя отменить.")) return;
  localStorage.removeItem("bookings");
  load();
}

load();
</script>

</body>
</html>
